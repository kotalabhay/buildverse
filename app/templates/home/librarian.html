{% extends 'layouts/base.html' %}
{% load static %}

{% block title %} Self Service {% endblock title %}

{% block stylesheets %}
<link rel="stylesheet" href="{% static 'assets/css/home/self-service.css' %}" />
{% endblock stylesheets %}

{% block content %}
<div class="container-fluid ps-xl-5 px-1 py-xl-1 py-3 overflow-x-hidden">
  <div class="row">
    <div class="col-12">
      <div class="card main-card">
        <div class="card-header pb-0">
          <div class="d-lg-flex">
            <div>
              <h5 class="mb-0">Self Service</h5>
            </div>
          </div>
        </div>
        <div class="card-body px-3 pb-0">
          <div class="row mb-3">
            <div class="col-xl-custom col-12">
              <div class="card card-hover bg-gradient-primary cursor-pointer mb-1" onclick="load({})">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="tickets-counter">
                        <p class="text-white counter-text">Total Tickets</p>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-white shadow text-center border-radius-md tickets-counter">
                        <p class="text-dark counter-value" id="total-tickets">0</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-custom col-12">
              <div class="card card-hover bg-gradient-success cursor-pointer mb-1"
                onclick="load({'approval_status': 'approved'})">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="tickets-counter">
                        <p class="text-white counter-text">Approved Tickets</p>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-white shadow text-center border-radius-md tickets-counter">
                        <p class="text-dark counter-value" id="approved-tickets">0</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-custom col-12">
              <div class="card card-hover bg-gradient-danger cursor-pointer mb-1"
                onclick="load({'approval_status': 'rejected'})">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="tickets-counter">
                        <p class="text-white counter-text">Rejected Tickets</p>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-white shadow text-center border-radius-md tickets-counter">
                        <p class="text-dark counter-value" id="rejected-tickets">0</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-custom col-12">
              <div class="card card-hover bg-gradient-warning cursor-pointer mb-1"
                onclick="load({'approval_status': 'pending'})">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="tickets-counter">
                        <p class="text-white counter-text">Pending Tickets</p>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-white shadow text-center border-radius-md tickets-counter">
                        <p class="text-dark counter-value" id="pending-tickets">0</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-custom col-12">
              <div class="card card-hover bg-gradient-secondary cursor-pointer mb-1"
                onclick="load({'status': 'Failed'})">
                <div class="card-body p-3">
                  <div class="row">
                    <div class="col-8">
                      <div class="tickets-counter">
                        <p class="text-white counter-text">Failed Tickets</p>
                      </div>
                    </div>
                    <div class="col-4 text-end">
                      <div class="icon icon-shape bg-white shadow text-center border-radius-md tickets-counter">
                        <p class="text-dark counter-value" id="failed-tickets">0</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-flush dataTable-table" id="tickets-list" style="width: 100%;">
              <thead class="thead-light">
                <tr>
                  <th class="text-dark">Systems</th>
                  <th class="text-dark">Title</th>
                  <th class="text-dark">Category</th>
                  <th class="text-dark">Priority</th>
                  <th class="text-dark">Assigned To</th>
                  <th class="text-dark">Created By</th>
                  <th class="text-dark">Approval Status</th>
                  <th class="text-dark">Status</th>
                  <th class="text-dark">Action</th>
                </tr>
              </thead>
            </table>
          </div>
        </div>
      </div>
      <div class="card content-card" style="display: none;">
        <div class="card-header pb-0">
          <div class="d-lg-flex align-items-baseline">
            <div class="me-3">
              <a href="#" onclick="backToMain()"><i class="fa fa-arrow-left"></i></a>
            </div>
            <div>
              <h5 class="mb-0" id="ticket-heading">Create Ticket</h5>
            </div>
          </div>
        </div>
        <div class="card-body px-lg-8 px-3 pb-0">
          <div class="custom-form-border px-xl-6 py-xl-4 p-3 mb-5">
            <div class="row">
              <div class="col-12 mb-3">
                <label class="form-label-lg">Title</label>
                <input type="text" class="form-control ticket-owner-disabled-input" id="title" placeholder="Title" />
              </div>
            </div>
            <div class="row">
              <div class="col-xl-8 col-12 mb-3">
                <label class="form-label-lg">System</label>
                <select class="form-control disabled-input" id="system" onchange="changeSystem()">
                  <option value="" selected disabled>--Select System--</option>
                  {% for i in systems %}
                  <option value="{{i.id}}">{{i}}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="col-xl-4 col-12 mb-3">
                <label class="form-label-lg">Priority</label>
                <select class="form-control ticket-owner-disabled-input select-priority" id="priority">
                  <option value="" selected disabled>--Select Priority--</option>
                  <option value="Critical" class="text-bold badge-critical">Critical</option>
                  <option value="High" class="text-bold badge-high">High</option>
                  <option value="Medium" class="text-bold badge-medium">Medium</option>
                  <option value="Low" class="text-bold badge-low">Low</option>
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-xl-8 col-12 mb-3">
                <label class="form-label-lg">Category</label>
                <select class="form-control disabled-input" id="category" onchange="changeCategory()">
                  <option value="" selected disabled>--Select Category--</option>
                </select>
              </div>
              <div class="col-xl-4 col-12 mb-3 mt-xl-2rem" id="hiddenChoices">
                <div class="d-flex align-items-center justify-content-start">
                  <div class="form-check me-3">
                    <input type="radio" class="form-check-input" name="category_type" id="single"
                      onclick="showSingleModal()" />
                    <label class="custom-control-label" for="single">Single</label>
                  </div>
                  <div class="form-check">
                    <input type="radio" class="form-check-input" name="category_type" id="bulk"
                      onclick="showBulkModal()" />
                    <label class="custom-control-label" for="bulk">Bulk</label>
                  </div>
                </div>
              </div>
              <div class="col-xl-6 col-12 mb-3 mt-xl-2rem" id="btnBulkPreview">
                <div class="mb-3">
                  <button class="btn bg-gradient-primary" title="Preview" data-toggle="tooltip"
                    onclick="previewCSV()">Preview</button>
                </div>
              </div>
            </div>
            <div class="row" id="hidden-single-additional-info">
              <div class="col-12 mb-3">
                <label class="form-label-lg mb-3">Additional Information</label>
                <div id="single-additional-info-div"></div>
              </div>
            </div>
            <div class="row">
              <div class="col-12 mb-3">
                <label class="form-label-lg">Comments</label>
                <textarea type="text" class="form-control ticket-owner-disabled-input" id="comments"
                  placeholder="Comments"></textarea>
              </div>
            </div>
            <div class="row hidden-system-owner-div">
              <div class="col-xl-4 col-12 mb-3">
                <div id="approval-status-div"></div>
              </div>
            </div>
            <div class="row hidden-system-owner-div">
              <div class="col-12 mb-3">
                <div id="remarks-div"></div>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <div>
                  <button class="btn bg-gradient-success" id="btn-create-ticket" onclick="submitTicket()">Create
                    Ticket</button>
                  <button class="btn bg-gradient-warning" id="btn-update-ticket" onclick="updateTicket()">Update
                    Ticket</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modal-single" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Additional Information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="single-additional-info"></div>
      </div>
      <div class="modal-footer">
        <button class="btn bg-gradient-success" onclick="submitSingleAdditionalInfo()">Submit</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modal-bulk" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Additional Information</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <button class="btn btn-light p-2" title="CSV" data-toggle="tooltip" onclick="downloadSampleCSV()">
            <img src="{% static 'assets/img/csv.png' %}" alt="csv" height="25px" width="25px">
            <span class="ms-1">Sample download</span>
          </button>
        </div>
        <div class="mb-3">
          <label class="form-label-lg">Upload File</label>
          <input type="file" class="form-control" id="attachment" accept=".csv" oninput="uploadAttachment()" />
        </div>
        <div class="mb-3" id="preview-section" style="display: none;">
          <button class="btn bg-gradient-primary" title="Preview" data-toggle="tooltip"
            onclick="previewCSV()">Preview</button>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modal-ticket-details" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ticket Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div id="ticket-details-div"></div>
      </div>
    </div>
  </div>
</div>
{% endblock content %}

{% block javascripts %}
<script src="{% static 'assets/js/home/self-service.js' %}"></script>
{% endblock javascripts %}